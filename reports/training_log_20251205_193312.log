--- Starting Training: Dueling_DDQN 20251205_193312 ---
--- Hyperparameters ---
device: cuda
seed: 42
keep_top_n: 1000
min_ratings: 5
val_ratio: 0.2
data_rel_path: data/ml-latest-small
model_base: models/dqn_movielens.pt
model_finetuned: models/dqn_movielens_finetuned.pt
plot_summary: reports/figures/training_summary.png
model_arch: Dueling
use_double_q: True
history_window: 10
hidden_dim: 128
dropout_rate: 0.2
buffer_size: 100000
batch_size: 128
learning_rate: 0.0003
gamma: 0.9
target_update: 1000
base_n_updates: 10000
log_interval: 500
weight_decay: 1e-05
repeat_penalty: 1
popularity_penalty: 0.2
ft_n_steps: 2000
ft_batch_size: 32
ft_lr: 1e-05
ft_weight_decay: 1e-05
margin: 0.5
neg_per_pos: 5
use_candidates: True
candidate_k: 200
frac_candidate: 0.5
---- Architecture: Dueling | Algorithm: DDQN ------
Total unique movies with ratings before filtering: 9724
Filtered to top 1000 movies. Remaining Ratings: 61256
Filtered users with < 5 ratings. Ratings dropped: 3
[RecoEnv] state_dim=200, n_actions=1000, repeat_penalty=1, popularity_penalty=0.2  
Mode=Flattened 
train_transitions=96990, val_transitions=24252
[RecoEnv] reward(train): min=-1.426, max=0.997, mean=-0.118
Sample train rewards: [ 0.8776923  -0.5         0.4823077  -0.5         0.97692305 -0.5
  0.4076923  -0.5         0.90076923 -0.5         0.47230768 -0.5
  0.47153845 -0.5         0.8676923  -0.5         0.43384615 -0.5
  0.44846153 -0.5       ]
DuelingDQN(
  (feature_layer): Sequential(
    (0): Linear(in_features=200, out_features=128, bias=True)
    (1): ReLU()
    (2): Dropout(p=0.2, inplace=False)
    (3): Linear(in_features=128, out_features=128, bias=True)
  )
  (value_stream): Sequential(
    (0): Linear(in_features=128, out_features=128, bias=True)
    (1): ReLU()
    (2): Linear(in_features=128, out_features=1, bias=True)
  )
  (advantage_stream): Sequential(
    (0): Linear(in_features=128, out_features=128, bias=True)
    (1): ReLU()
    (2): Linear(in_features=128, out_features=1000, bias=True)
  )
)
[Agent] Preloaded 96990 transitions into replay buffer.
Loading Train/Validation Data...
--- Loading Data (Top 1000 movies, Min 5 ratings) ---
Total unique movies with ratings before filtering: 9724
Filtered to top 1000 movies. Remaining Ratings: 61256
Filtered users with < 5 ratings. Ratings dropped: 3
Starting training for 10000 steps...
Step  200 | Loss: 0.1304 | NDCG@10: 0.1241 | Avg Q: -0.088 | Reward: 0.652
--- Best Model Saved!
Step  400 | Loss: 0.1267 | NDCG@10: 0.1468 | Avg Q: -0.164 | Reward: 0.859
--- Best Model Saved!
Step  600 | Loss: 0.1251 | NDCG@10: 0.1377 | Avg Q: -0.242 | Reward: 0.815
Step  800 | Loss: 0.1237 | NDCG@10: 0.1361 | Avg Q: -0.200 | Reward: 0.837
Step 1000 | Loss: 0.1227 | NDCG@10: 0.1697 | Avg Q: -0.284 | Reward: 0.870
--- Best Model Saved!
Step 1200 | Loss: 0.1222 | NDCG@10: 0.1875 | Avg Q: -0.004 | Reward: 1.120
--- Best Model Saved!
Step 1400 | Loss: 0.1212 | NDCG@10: 0.1864 | Avg Q: -0.004 | Reward: 1.022
Step 1600 | Loss: 0.1205 | NDCG@10: 0.1491 | Avg Q: -0.041 | Reward: 0.826
Step 1800 | Loss: 0.1198 | NDCG@10: 0.1650 | Avg Q: -0.036 | Reward: 0.902
Step 2000 | Loss: 0.1189 | NDCG@10: 0.1359 | Avg Q: -0.068 | Reward: 0.674
Step 2200 | Loss: 0.1187 | NDCG@10: 0.1443 | Avg Q: 0.298 | Reward: 0.717
Step 2400 | Loss: 0.1181 | NDCG@10: 0.1965 | Avg Q: 0.251 | Reward: 0.957
--- Best Model Saved!
Step 2600 | Loss: 0.1177 | NDCG@10: 0.1429 | Avg Q: 0.271 | Reward: 0.902
Step 2800 | Loss: 0.1171 | NDCG@10: 0.1569 | Avg Q: 0.278 | Reward: 0.935
Step 3000 | Loss: 0.1165 | NDCG@10: 0.1751 | Avg Q: 0.263 | Reward: 0.924
Step 3200 | Loss: 0.1165 | NDCG@10: 0.1548 | Avg Q: 0.557 | Reward: 0.793
Step 3400 | Loss: 0.1162 | NDCG@10: 0.1514 | Avg Q: 0.571 | Reward: 0.696
Step 3600 | Loss: 0.1158 | NDCG@10: 0.1582 | Avg Q: 0.575 | Reward: 0.728
Step 3800 | Loss: 0.1154 | NDCG@10: 0.1368 | Avg Q: 0.597 | Reward: 0.696
Step 4000 | Loss: 0.1150 | NDCG@10: 0.1600 | Avg Q: 0.541 | Reward: 0.630
Step 4200 | Loss: 0.1147 | NDCG@10: 0.1749 | Avg Q: 0.888 | Reward: 0.674
Step 4400 | Loss: 0.1144 | NDCG@10: 0.1629 | Avg Q: 0.861 | Reward: 0.598
Step 4600 | Loss: 0.1140 | NDCG@10: 0.1739 | Avg Q: 0.908 | Reward: 0.630
Step 4800 | Loss: 0.1137 | NDCG@10: 0.1637 | Avg Q: 0.817 | Reward: 0.750
Step 5000 | Loss: 0.1134 | NDCG@10: 0.1765 | Avg Q: 0.825 | Reward: 0.728
Step 5200 | Loss: 0.1134 | NDCG@10: 0.1791 | Avg Q: 1.236 | Reward: 0.837
Step 5400 | Loss: 0.1132 | NDCG@10: 0.1713 | Avg Q: 1.170 | Reward: 0.630
Step 5600 | Loss: 0.1130 | NDCG@10: 0.1920 | Avg Q: 1.201 | Reward: 0.685
Step 5800 | Loss: 0.1127 | NDCG@10: 0.1845 | Avg Q: 1.173 | Reward: 0.598
Step 6000 | Loss: 0.1125 | NDCG@10: 0.1833 | Avg Q: 1.120 | Reward: 0.707
Step 6200 | Loss: 0.1124 | NDCG@10: 0.2107 | Avg Q: 1.524 | Reward: 0.891
--- Best Model Saved!
Step 6400 | Loss: 0.1123 | NDCG@10: 0.1849 | Avg Q: 1.503 | Reward: 0.793
Step 6600 | Loss: 0.1121 | NDCG@10: 0.1850 | Avg Q: 1.483 | Reward: 0.707
Step 6800 | Loss: 0.1120 | NDCG@10: 0.1844 | Avg Q: 1.503 | Reward: 0.674
Step 7000 | Loss: 0.1118 | NDCG@10: 0.1896 | Avg Q: 1.564 | Reward: 0.652
Step 7200 | Loss: 0.1119 | NDCG@10: 0.2035 | Avg Q: 1.948 | Reward: 0.859
Step 7400 | Loss: 0.1119 | NDCG@10: 0.1979 | Avg Q: 1.996 | Reward: 0.793
Step 7600 | Loss: 0.1119 | NDCG@10: 0.1953 | Avg Q: 1.939 | Reward: 0.804
Step 7800 | Loss: 0.1118 | NDCG@10: 0.1792 | Avg Q: 1.971 | Reward: 0.728
Step 8000 | Loss: 0.1117 | NDCG@10: 0.1687 | Avg Q: 1.914 | Reward: 0.707
Step 8200 | Loss: 0.1119 | NDCG@10: 0.1919 | Avg Q: 2.329 | Reward: 0.772
Step 8400 | Loss: 0.1120 | NDCG@10: 0.2064 | Avg Q: 2.366 | Reward: 0.880
Step 8600 | Loss: 0.1120 | NDCG@10: 0.1907 | Avg Q: 2.285 | Reward: 0.891
Step 8800 | Loss: 0.1121 | NDCG@10: 0.1969 | Avg Q: 2.370 | Reward: 0.891
Step 9000 | Loss: 0.1121 | NDCG@10: 0.1802 | Avg Q: 2.312 | Reward: 0.859
Step 9200 | Loss: 0.1123 | NDCG@10: 0.1653 | Avg Q: 2.848 | Reward: 0.793
Step 9400 | Loss: 0.1125 | NDCG@10: 0.1466 | Avg Q: 2.796 | Reward: 0.707
Step 9600 | Loss: 0.1126 | NDCG@10: 0.1478 | Avg Q: 2.818 | Reward: 0.630
Step 9800 | Loss: 0.1127 | NDCG@10: 0.1525 | Avg Q: 2.826 | Reward: 0.674
Step 10000 | Loss: 0.1127 | NDCG@10: 0.1584 | Avg Q: 2.775 | Reward: 0.674
Training Complete!
 > Model saved to: D:\Git\1508RL\ECE1508RL_project\models\Dueling_DDQN_20251205_193312.pt
 > Plot saved to:  D:\Git\1508RL\ECE1508RL_project\reports\figures\Dueling_DDQN_20251205_193312.png
 > Log saved to:   D:\Git\1508RL\ECE1508RL_project\reports\training_log_20251205_193312.log
